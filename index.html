<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TaxSyncQC</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui; max-width: 700px; margin: 0 auto; padding: 1rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
    .container { background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
    h1 { color: #667eea; font-size: 1.75rem; margin-bottom: 0.5rem; }
    .tabs { display: flex; gap: 1rem; margin: 1.5rem 0; border-bottom: 2px solid #eee; }
    .tab { padding: 0.75rem 1.5rem; cursor: pointer; border: none; background: none; font-size: 1rem; font-weight: 600; color: #999; }
    .tab.active { color: #667eea; border-bottom: 3px solid #667eea; margin-bottom: -2px; }
    .form-section { display: none; }
    .form-section.active { display: block; }
    .form-row { display: grid; grid-template-columns: 100px 1fr; gap: 1rem; align-items: center; margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 6px; }
    .form-row label { font-weight: 600; color: #333; font-size: 0.9rem; }
    .form-row input { padding: 0.6rem; border: 2px solid #ddd; border-radius: 6px; font-size: 1rem; width: 100%; }
    .form-row input:focus { border-color: #667eea; outline: none; }
    .form-row .helper { grid-column: 2; font-size: 0.85rem; color: #666; margin-top: -0.5rem; }
    button.primary { background: #667eea; color: white; border: none; padding: 1rem 2rem; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 600; width: 100%; margin-top: 1rem; }
    button.primary:hover { background: #5568d3; }
    button.secondary { background: #e0e0e0; color: #333; border: none; padding: 0.75rem; border-radius: 6px; cursor: pointer; width: 100%; margin-top: 0.5rem; }
    .result { background: #e6f7ff; border-left: 4px solid #1890ff; padding: 1.5rem; margin: 1.5rem 0; border-radius: 6px; display: none; }
    .lang-toggle { text-align: right; margin-bottom: 1rem; }
    .lang-toggle button { border: none; background: none; cursor: pointer; padding: 0.5rem 1rem; font-weight: 600; }
  </style>
</head>
<body>
  <div class="container">
    <div class="lang-toggle">
      <button onclick="setLang('en')" id="btn-en">EN</button>
      <button onclick="setLang('fr')" id="btn-fr">FR</button>
    </div>

    <h1 id="title">üí∞ TaxSyncQC</h1>
    <p id="subtitle">Quebec + Federal tax estimator 2025</p>

    <div class="tabs">
      <button class="tab active" onclick="showTab('rl1')">RL-1 (QC)</button>
      <button class="tab" onclick="showTab('t4')">T4 (Federal)</button>
    </div>

    <div id="rl1-section" class="form-section active">
      <div class="form-row">
        <label>Line A</label>
        <input type="number" id="rl1-a" placeholder="35000" min="0">
        <div class="helper" id="rl1-a-help">Employment income</div>
      </div>
      <div class="form-row">
        <label>Line C</label>
        <input type="number" id="rl1-c" placeholder="2120" min="0">
        <div class="helper" id="rl1-c-help">QPP contributions</div>
      </div>
      <div class="form-row">
        <label>Line D</label>
        <input type="number" id="rl1-d" placeholder="230" min="0">
        <div class="helper" id="rl1-d-help">QPIP premiums</div>
      </div>
      <div class="form-row">
        <label>Line L</label>
        <input type="number" id="rl1-l" placeholder="300" min="0">
        <div class="helper" id="rl1-l-help">Union dues (optional)</div>
      </div>
    </div>

    <div id="t4-section" class="form-section">
      <div class="form-row">
        <label>Box 14</label>
        <input type="number" id="t4-14" placeholder="35000" min="0">
        <div class="helper" id="t4-14-help">Employment income</div>
      </div>
      <div class="form-row">
        <label>Box 16</label>
        <input type="number" id="t4-16" placeholder="2120" min="0">
        <div class="helper" id="t4-16-help">CPP contributions</div>
      </div>
      <div class="form-row">
        <label>Box 18</label>
        <input type="number" id="t4-18" placeholder="630" min="0">
        <div class="helper" id="t4-18-help">EI premiums</div>
      </div>
      <div class="form-row">
        <label>Box 44</label>
        <input type="number" id="t4-44" placeholder="300" min="0">
        <div class="helper" id="t4-44-help">Union dues (optional)</div>
      </div>
    </div>

    <button class="primary" onclick="estimate()">Calculate Refund</button>
    <button class="secondary" onclick="clearForm()">Clear</button>

    <div id="output"></div>
  </div>

  <script>
    const translations = {
      en: {
        title: "üí∞ TaxSyncQC",
        subtitle: "Quebec + Federal tax estimator 2025",
        rl1A: "Employment income",
        rl1C: "QPP contributions",
        rl1D: "QPIP premiums",
        rl1L: "Union dues (optional)",
        t414: "Employment income",
        t416: "CPP contributions",
        t418: "EI premiums",
        t444: "Union dues (optional)",
        calculate: "Calculate Refund",
        clear: "Clear",
        invalidIncome: "‚ùå Enter income (Line A or Box 14)"
      },
      fr: {
        title: "üí∞ TaxSyncQC",
        subtitle: "Estimateur Qu√©bec + F√©d√©ral 2025",
        rl1A: "Revenu d'emploi",
        rl1C: "Cotisations RRQ",
        rl1D: "Cotisations RQAP",
        rl1L: "Cotisations syndicales (optionnel)",
        t414: "Revenu d'emploi",
        t416: "Cotisations RPC",
        t418: "Cotisations AE",
        t444: "Cotisations syndicales (optionnel)",
        calculate: "Calculer remboursement",
        clear: "Effacer",
        invalidIncome: "‚ùå Entrez revenu (Ligne A ou Case 14)"
      }
    };

    let lang = 'en';
    let activeTab = 'rl1';
    const _ = (key) => translations[lang][key] || key;

    function setLang(newLang) {
      lang = newLang;
      document.getElementById('btn-en').style.fontWeight = lang === 'en' ? 'bold' : 'normal';
      document.getElementById('btn-fr').style.fontWeight = lang === 'fr' ? 'bold' : 'normal';
      updateUI();
    }

    function showTab(tab) {
      activeTab = tab;
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById(tab + '-section').classList.add('active');
    }

    function updateUI() {
      document.getElementById('title').textContent = _('title');
      document.getElementById('subtitle').textContent = _('subtitle');
      document.getElementById('rl1-a-help').textContent = _('rl1A');
      document.getElementById('rl1-c-help').textContent = _('rl1C');
      document.getElementById('rl1-d-help').textContent = _('rl1D');
      document.getElementById('rl1-l-help').textContent = _('rl1L');
      document.getElementById('t4-14-help').textContent = _('t414');
      document.getElementById('t4-16-help').textContent = _('t416');
      document.getElementById('t4-18-help').textContent = _('t418');
      document.getElementById('t4-44-help').textContent = _('t444');
    }

    function clearForm() {
      document.querySelectorAll('input').forEach(i => i.value = '');
      document.getElementById('output').innerHTML = '';
    }

    function calculateSolidarity(income) {
      const BASE = 531, START = 57965, END = 64125;
      let amt = BASE;
      if (income > START) amt = income >= END ? 0 : amt * (1 - (income - START) / (END - START));
      return Math.round(amt * 100) / 100;
    }

    function calculateWorkPremium(income) {
      if (income < 7200) return 0;
      return Math.min(Math.round(Math.min(income - 7200, 33100) * 0.26 * 100) / 100, 728);
    }

    function estimateFederal(income) {
      let cwb = 0;
      if (income <= 25539) cwb = Math.min(income * 0.27, 1519);
      else if (income <= 35539) cwb = Math.max(0, 1519 - (income - 25539) * 0.15);
      const bpa = Math.max(0, 15705 - Math.max(0, income - 165430) * 15705 / 70000);
      return { cwb: Math.round(cwb * 100) / 100, bpaSavings: Math.round(bpa * 0.15 * 100) / 100 };
    }

    function estimate() {
      let income = 0;
      if (activeTab === 'rl1') {
        income = parseFloat(document.getElementById('rl1-a').value) || 0;
      } else {
        income = parseFloat(document.getElementById('t4-14').value) || 0;
      }

      if (!income) {
        document.getElementById('output').innerHTML = `<p style="color:red">${_('invalidIncome')}</p>`;
        return;
      }

      const qc = { solidarity: calculateSolidarity(income), workPremium: calculateWorkPremium(income) };
      const fed = estimateFederal(income);
      const qcTotal = qc.solidarity + qc.workPremium;
      const totalBenefit = qcTotal + fed.bpaSavings + fed.cwb;
      const cashBack = qc.workPremium + fed.cwb;

      document.getElementById('output').innerHTML = `<div class="result" style="display:block;">
        <h3>üßæ ${lang === 'fr' ? 'Estimation 2025' : 'Estimate 2025'}</h3>
        <p><strong>üíº ${lang === 'fr' ? 'Revenu' : 'Income'}: $${income.toLocaleString()}</strong></p>
        <h4>üá∂üá® Qu√©bec</h4>
        <p>üí∞ ${lang === 'fr' ? 'Cr√©dit solidarit√©' : 'Solidarity'}: $${qc.solidarity}</p>
        <p>üë∑ ${lang === 'fr' ? 'Prime travail' : 'Work Premium'}: $${qc.workPremium}</p>
        <p><strong>‚úÖ Total QC: $${qcTotal.toFixed(2)}</strong></p>
        <h4>üá®üá¶ ${lang === 'fr' ? 'F√©d√©ral' : 'Federal'}</h4>
        <p>üõ°Ô∏è BPA: $${fed.bpaSavings}</p>
        <p>üíµ ${lang === 'fr' ? 'PTE' : 'CWB'}: $${fed.cwb}</p>
        <p><strong>‚úÖ Total Fed: $${(fed.bpaSavings + fed.cwb).toFixed(2)}</strong></p>
        <hr style="margin: 1rem 0; border: none; border-top: 2px solid #ddd;">
        <p><strong>üéØ ${lang === 'fr' ? 'Avantage total' : 'Total Benefit'}: $${totalBenefit.toFixed(2)}</strong></p>
        <p style="font-size: 1.25rem; color: #667eea;"><strong>üí∏ ${lang === 'fr' ? 'Remboursement' : 'Cash Back'}: $${cashBack.toFixed(2)}</strong></p>
      </div>`;
    }

    updateUI();
  </script>
</body>
</html>
