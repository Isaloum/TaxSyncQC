<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TaxSyncQC ‚Äî Estimation officielle Qu√©bec 2025</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; max-width: 800px; margin: 1rem auto; padding: 0 1rem; line-height: 1.5; }
    .lang-toggle { text-align: right; margin-bottom: 1rem; }
    .tabs { display: flex; margin-bottom: 1rem; border-bottom: 1px solid #ccc; }
    .tab-btn { padding: 0.75rem 1.5rem; background: #f0f0f0; border: none; cursor: pointer; }
    .tab-btn.active { background: #1890ff; color: white; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    fieldset { border: 1px solid #ddd; border-radius: 6px; padding: 1rem; margin-bottom: 1.5rem; }
    legend { font-weight: bold; padding: 0 0.5rem; }
    .input-group { margin-bottom: 1rem; }
    label { display: block; font-weight: bold; margin-bottom: 0.25rem; }
    .box-label { color: #1890ff; font-family: monospace; }
    .hint { font-size: 0.85rem; color: #666; margin-top: 0.25rem; }
    input, select { width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; }
    .toggle { margin: 1rem 0; }
    button { background: #1890ff; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 4px; cursor: pointer; font-size: 1.1em; }
    button.secondary { background: #52c41a; margin-left: 0.5rem; }
    .result { background: #e6f7ff; border-left: 4px solid #1890ff; padding: 1rem; margin: 1.5rem 0; border-radius: 4px; }
    .warnings { color: #fa8c16; margin-top: 1rem; }
    .json-output { background: #f5f5f5; padding: 1rem; border-radius: 4px; overflow-x: auto; font-family: monospace; font-size: 0.9em; margin-top: 1rem; }
  </style>
</head>
<body>
  <div class="lang-toggle">
    <button onclick="setLang('en')" id="btn-en">EN</button>
    <button onclick="setLang('fr')" id="btn-fr" style="font-weight:bold">FR</button>
  </div>

  <h1 data-i18n="title">üí∞ TaxSyncQC ‚Äî Estimation officielle Qu√©bec 2025</h1>
  <p data-i18n="subtitle">Bas√© sur les documents <strong>RL-1-T(2025-10)</strong> et <strong>T4 (2025)</strong> de Revenu Qu√©bec et l'ARC.</p>

  <div class="toggle">
    <label>
      <input type="checkbox" id="modeToggle" onchange="toggleMode()">
      <span data-i18n="advancedMode">Mode avanc√© (tous les champs)</span>
    </label>
  </div>

  <div class="tabs">
    <button class="tab-btn active" onclick="showTab('rl1')" data-i18n="tabRL1">RL-1 (Revenu Qu√©bec)</button>
    <button class="tab-btn" onclick="showTab('t4')" data-i18n="tabT4">T4 (ARC)</button>
    <button class="tab-btn" onclick="showTab('both')" data-i18n="tabBoth">Les deux</button>
  </div>

  <!-- RL-1 Tab -->
  <div id="rl1Tab" class="tab-content active">
    <form id="rl1Form">
      <fieldset>
        <legend data-i18n="essentialRequired">‚úÖ Essentiel (requis)</legend>
        <div class="input-group">
          <label><span class="box-label">Case A</span> ‚Äî <span data-i18n="rl1BoxA">Revenu d'emploi (Ligne 101)</span></label>
          <input type="number" id="rl1_A" step="100" placeholder="Ex: 60000">
          <div class="hint" data-i18n="hintRL1BoxA">Box A ‚Äî top left on RL-1</div>
        </div>
        <div class="input-group">
          <label><span class="box-label">Case F</span> ‚Äî <span data-i18n="rl1BoxF">Cotisations syndicales (Ligne 397.1)</span></label>
          <input type="number" id="rl1_F" step="1" placeholder="Ex: 400">
        </div>
        <div class="input-group">
          <label data-i18n="sinLabel">NAS</label>
          <input type="text" id="rl1_sin" maxlength="11" placeholder="Ex: 123 456 789">
        </div>
      </fieldset>

      <fieldset id="rl1Deductions" style="display:none;">
        <legend data-i18n="deductions">‚ö†Ô∏è D√©ductions</legend>
        <div class="input-group">
          <label><span class="box-label">Case B.A</span> ‚Äî <span data-i18n="rl1BoxBA">Cotisations RRQ (Ligne 98)</span></label>
          <input type="number" id="rl1_BA" step="1">
        </div>
        <div class="input-group">
          <label><span class="box-label">Case H</span> ‚Äî <span data-i18n="rl1BoxH">Prime d'assurance parentale (Ligne 97)</span></label>
          <input type="number" id="rl1_H" step="1">
        </div>
        <div class="input-group">
          <label><span class="box-label">Case D</span> ‚Äî <span data-i18n="rl1BoxD">Cotisations RPA (Ligne 205)</span></label>
          <input type="number" id="rl1_D" step="1">
        </div>
        <div class="input-group">
          <label><span class="box-label">Case D-1</span> ‚Äî <span data-i18n="rl1BoxD1">Arrangement de retraite (Ligne 207)</span></label>
          <input type="number" id="rl1_D1" step="1">
        </div>
        <div class="input-group">
          <label><span class="box-label">Case N</span> ‚Äî <span data-i18n="rl1BoxN">Dons de bienfaisance (Ligne 395)</span></label>
          <input type="number" id="rl1_N" step="1">
        </div>
      </fieldset>

      <fieldset id="rl1Benefits" style="display:none;">
        <legend data-i18n="taxableBenefits">üîπ Avantages imposables (inclus dans la Case A)</legend>
        <div class="input-group">
          <label><span class="box-label">Case J</span> ‚Äî <span data-i18n="rl1BoxJ">R√©gime priv√© de soins de sant√© (Ligne 381)</span></label>
          <input type="number" id="rl1_J" step="1">
        </div>
        <div class="input-group">
          <label><span class="box-label">Case K</span> ‚Äî <span data-i18n="rl1BoxK">D√©placements (r√©gion √©loign√©e) (Ligne 236)</span></label>
          <input type="number" id="rl1_K" step="1">
        </div>
        <div class="input-group">
          <label><span class="box-label">Case L</span> ‚Äî <span data-i18n="rl1BoxL">Autres avantages</span></label>
          <input type="number" id="rl1_L" step="1">
        </div>
        <div class="input-group">
          <label><span class="box-label">Case M</span> ‚Äî <span data-i18n="rl1BoxM">Commissions (Ligne 100)</span></label>
          <input type="number" id="rl1_M" step="1">
        </div>
      </fieldset>
    </form>
  </div>

  <!-- T4 Tab -->
  <div id="t4Tab" class="tab-content">
    <form id="t4Form">
      <fieldset>
        <legend data-i18n="essentialRequired">‚úÖ Essentiel (requis)</legend>
        <div class="input-group">
          <label><span class="box-label">Box 14</span> ‚Äî <span data-i18n="t4Box14">Revenus d'emploi (Ligne 10100)</span></label>
          <input type="number" id="t4_14" step="100" placeholder="Ex: 60000">
          <div class="hint" data-i18n="hintT4Box14">Box 14 ‚Äî center-left on T4</div>
        </div>
        <div class="input-group">
          <label><span class="box-label">Box 44</span> ‚Äî <span data-i18n="t4Box44">Cotisations syndicales (Ligne 21200)</span></label>
          <input type="number" id="t4_44" step="1" placeholder="Ex: 400">
        </div>
        <div class="input-group">
          <label data-i18n="sinLabelT4">SIN</label>
          <input type="text" id="t4_sin" maxlength="11" placeholder="Ex: 123-456-789">
        </div>
      </fieldset>

      <fieldset id="t4Deductions" style="display:none;">
        <legend data-i18n="deductions">‚ö†Ô∏è D√©ductions</legend>
        <div class="input-group">
          <label><span class="box-label">Box 17</span> ‚Äî <span data-i18n="t4Box17">Cotisations RRQ (QC)</span> / <span class="box-label">Box 16</span> ‚Äî <span data-i18n="t4Box16">RPC (autres)</span></label>
          <input type="number" id="t4_17" step="1" placeholder="QC: Box 17">
          <input type="number" id="t4_16" step="1" placeholder="Elsewhere: Box 16">
        </div>
        <div class="input-group">
          <label><span class="box-label">Box 55</span> ‚Äî <span data-i18n="t4Box55">RPAP (QC)</span> / <span class="box-label">Box 18</span> ‚Äî <span data-i18n="t4Box18">AE</span></label>
          <input type="number" id="t4_55" step="1" placeholder="QC: Box 55">
          <input type="number" id="t4_18" step="1" placeholder="Elsewhere: Box 18">
        </div>
        <div class="input-group">
          <label><span class="box-label">Box 20</span> ‚Äî <span data-i18n="t4Box20">Cotisations RPA (Ligne 20700)</span></label>
          <input type="number" id="t4_20" step="1">
        </div>
        <div class="input-group">
          <label><span class="box-label">Box 52</span> ‚Äî <span data-i18n="t4Box52">Facteur d'√©quivalence (Ligne 20600)</span></label>
          <input type="number" id="t4_52" step="1">
        </div>
        <div class="input-group">
          <label><span class="box-label">Box 46</span> ‚Äî <span data-i18n="t4Box46">Dons de bienfaisance</span></label>
          <input type="number" id="t4_46" step="1">
        </div>
      </fieldset>

      <fieldset id="t4Benefits" style="display:none;">
        <legend data-i18n="taxableBenefitsT4">üîπ Avantages imposables (d√©j√† inclus dans Box 14)</legend>
        <div class="input-group">
          <label><span class="box-label">Boxes 30, 32, 34, 36, 38, 40</span> ‚Äî <span data-i18n="t4BoxBenefits">Avantages divers (logement, auto, pr√™ts, etc.)</span></label>
          <input type="number" id="t4_benefits" step="1" placeholder="Total si connu">
        </div>
      </fieldset>
    </form>
  </div>

  <!-- Both Tab -->
  <div id="bothTab" class="tab-content">
    <p data-i18n="bothTabDesc">Entrez les donn√©es des deux formulaires ci-dessus ‚Äî utile pour les travailleurs en double statut (ex: autochtone, r√©serviste).</p>
  </div>

  <div class="input-group">
    <label data-i18n="rrspContribution">Contribution RRSP ($)</label>
    <input type="number" id="rrspInput" step="100" min="0" max="31560" value="0" placeholder="Ex: 5000">
    <div class="hint" data-i18n="hintRRSP">Maximum: $31,560 (2025 limit)</div>
  </div>

  <button type="button" onclick="calculate()" data-i18n="estimateButton">Estimer les cr√©dits</button>
  <button type="button" class="secondary" id="exportBtn" onclick="toggleJSON()" style="display:none;" data-i18n="exportButton">üìã Export JSON</button>

  <div id="output"></div>
  <div id="jsonOutput" class="json-output" style="display:none;"></div>

  <script src="tax-calculator-bundle.js"></script>
  <script>
    let lang = 'fr';
    let lastCalculationData = null;

    const translations = {
      en: {
        title: "üí∞ TaxSyncQC ‚Äî Official Quebec 2025 Estimator",
        subtitle: "Based on <strong>RL-1-T(2025-10)</strong> and <strong>T4 (2025)</strong> from Revenu Qu√©bec and CRA.",
        advancedMode: "Advanced mode (all fields)",
        tabRL1: "RL-1 (Revenu Qu√©bec)",
        tabT4: "T4 (CRA)",
        tabBoth: "Both",
        essentialRequired: "‚úÖ Essential (required)",
        rl1BoxA: "Employment income (Line 101)",
        hintRL1BoxA: "Box A ‚Äî top left on RL-1",
        rl1BoxF: "Union dues (Line 397.1)",
        sinLabel: "SIN",
        sinLabelT4: "SIN",
        deductions: "‚ö†Ô∏è Deductions",
        rl1BoxBA: "QPP contributions (Line 98)",
        rl1BoxH: "Parental insurance premium (Line 97)",
        rl1BoxD: "RPP contributions (Line 205)",
        rl1BoxD1: "Retirement arrangement (Line 207)",
        rl1BoxN: "Charitable donations (Line 395)",
        taxableBenefits: "üîπ Taxable benefits (included in Box A)",
        rl1BoxJ: "Private health services plan (Line 381)",
        rl1BoxK: "Travel (remote area) (Line 236)",
        rl1BoxL: "Other benefits",
        rl1BoxM: "Commissions (Line 100)",
        t4Box14: "Employment income (Line 10100)",
        hintT4Box14: "Box 14 ‚Äî center-left on T4",
        t4Box44: "Union dues (Line 21200)",
        t4Box17: "QPP contributions (QC)",
        t4Box16: "CPP (other provinces)",
        t4Box55: "QPIP (QC)",
        t4Box18: "EI",
        t4Box20: "RPP contributions (Line 20700)",
        t4Box52: "Pension adjustment (Line 20600)",
        t4Box46: "Charitable donations",
        taxableBenefitsT4: "üîπ Taxable benefits (already included in Box 14)",
        t4BoxBenefits: "Various benefits (housing, car, loans, etc.)",
        bothTabDesc: "Enter data from both forms above ‚Äî useful for dual-status workers (e.g., Indigenous, reservist).",
        rrspContribution: "RRSP Contribution ($)",
        hintRRSP: "Maximum: $31,560 (2025 limit)",
        estimateButton: "Estimate Credits",
        exportButton: "üìã Export JSON",
        resultTitle: "üßæ Quebec + Federal Estimate (2025)",
        grossIncome: "üíº Gross income",
        afterRRSP: "üìâ After RRSP",
        taxSavings: "üí∞ Tax savings",
        qcSection: "üá∂üá® Quebec",
        solidarityCredit: "üí∞ Solidarity credit",
        workPremium: "üë∑ Work premium",
        fedSection: "üá®üá¶ Federal",
        bpaSavings: "üõ°Ô∏è BPA savings",
        cwb: "üíµ CWB",
        totalBenefit: "üéØ Total benefit",
        cashRefund: "üí∏ Cash refund",
        warnings: "üí° Tips to increase your refund:",
        warningUnionDues: "Add union dues (Case F) ‚Äî could save $30-150 in taxes"
      },
      fr: {
        title: "üí∞ TaxSyncQC ‚Äî Estimation officielle Qu√©bec 2025",
        subtitle: "Bas√© sur les documents <strong>RL-1-T(2025-10)</strong> et <strong>T4 (2025)</strong> de Revenu Qu√©bec et l'ARC.",
        advancedMode: "Mode avanc√© (tous les champs)",
        tabRL1: "RL-1 (Revenu Qu√©bec)",
        tabT4: "T4 (ARC)",
        tabBoth: "Les deux",
        essentialRequired: "‚úÖ Essentiel (requis)",
        rl1BoxA: "Revenu d'emploi (Ligne 101)",
        hintRL1BoxA: "Case A ‚Äî en haut √† gauche du RL-1",
        rl1BoxF: "Cotisations syndicales (Ligne 397.1)",
        sinLabel: "NAS",
        sinLabelT4: "NAS",
        deductions: "‚ö†Ô∏è D√©ductions",
        rl1BoxBA: "Cotisations RRQ (Ligne 98)",
        rl1BoxH: "Prime d'assurance parentale (Ligne 97)",
        rl1BoxD: "Cotisations RPA (Ligne 205)",
        rl1BoxD1: "Arrangement de retraite (Ligne 207)",
        rl1BoxN: "Dons de bienfaisance (Ligne 395)",
        taxableBenefits: "üîπ Avantages imposables (inclus dans la Case A)",
        rl1BoxJ: "R√©gime priv√© de soins de sant√© (Ligne 381)",
        rl1BoxK: "D√©placements (r√©gion √©loign√©e) (Ligne 236)",
        rl1BoxL: "Autres avantages",
        rl1BoxM: "Commissions (Ligne 100)",
        t4Box14: "Revenus d'emploi (Ligne 10100)",
        hintT4Box14: "Case 14 ‚Äî au centre gauche du T4",
        t4Box44: "Cotisations syndicales (Ligne 21200)",
        t4Box17: "Cotisations RRQ (QC)",
        t4Box16: "RPC (autres provinces)",
        t4Box55: "RPAP (QC)",
        t4Box18: "AE",
        t4Box20: "Cotisations RPA (Ligne 20700)",
        t4Box52: "Facteur d'√©quivalence (Ligne 20600)",
        t4Box46: "Dons de bienfaisance",
        taxableBenefitsT4: "üîπ Avantages imposables (d√©j√† inclus dans Case 14)",
        t4BoxBenefits: "Avantages divers (logement, auto, pr√™ts, etc.)",
        bothTabDesc: "Entrez les donn√©es des deux formulaires ci-dessus ‚Äî utile pour les travailleurs en double statut (ex: autochtone, r√©serviste).",
        rrspContribution: "Contribution RRSP ($)",
        hintRRSP: "Maximum : 31 560 $ (limite 2025)",
        estimateButton: "Estimer les cr√©dits",
        exportButton: "üìã Exporter JSON",
        resultTitle: "üßæ Estimation Qu√©bec + F√©d√©ral (2025)",
        grossIncome: "üíº Revenu brut",
        afterRRSP: "üìâ Apr√®s RRSP",
        taxSavings: "üí∞ √âconomie d'imp√¥t",
        qcSection: "üá∂üá® Qu√©bec",
        solidarityCredit: "üí∞ Cr√©dit solidarit√©",
        workPremium: "üë∑ Prime au travail",
        fedSection: "üá®üá¶ F√©d√©ral",
        bpaSavings: "üõ°Ô∏è √âconomies BPA",
        cwb: "üíµ PTE",
        totalBenefit: "üéØ Avantage total",
        cashRefund: "üí∏ Remboursement",
        warnings: "üí° Conseils pour augmenter votre remboursement :",
        warningUnionDues: "Ajoutez vos cotisations syndicales (Case F) ‚Äî pourrait √©conomiser 30-150 $ d'imp√¥t"
      }
    };

    const _ = (key) => translations[lang][key] || key;

    function setLang(l) {
      lang = l;
      document.getElementById('btn-en').style.fontWeight = l === 'en' ? 'bold' : 'normal';
      document.getElementById('btn-fr').style.fontWeight = l === 'fr' ? 'bold' : 'normal';
      document.documentElement.lang = l;
      document.title = _('title').replace(/<[^>]*>/g, '');

      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        el.innerHTML = _(key);
      });
    }

    function toggleMode() {
      const advanced = document.getElementById('modeToggle').checked;
      ['rl1Deductions', 'rl1Benefits', 't4Deductions', 't4Benefits'].forEach(id => {
        document.getElementById(id).style.display = advanced ? 'block' : 'none';
      });
      document.getElementById('exportBtn').style.display = advanced && lastCalculationData ? 'inline-block' : 'none';
    }

    function showTab(tabId) {
      ['rl1Tab', 't4Tab', 'bothTab'].forEach(id => {
        document.getElementById(id).classList.toggle('active', id === tabId + 'Tab');
      });
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
    }

    function toggleJSON() {
      const jsonDiv = document.getElementById('jsonOutput');
      if (jsonDiv.style.display === 'none') {
        jsonDiv.style.display = 'block';
        document.getElementById('exportBtn').textContent = '‚úñÔ∏è ' + (lang === 'fr' ? 'Fermer JSON' : 'Close JSON');
      } else {
        jsonDiv.style.display = 'none';
        document.getElementById('exportBtn').innerHTML = _('exportButton');
      }
    }

    function getFormData() {
      const isRL1 = document.getElementById('rl1Tab').classList.contains('active');

      const data = {
        source: isRL1 ? 'RL-1' : 'T4',
        rl1: { A: null, F: null, sin: null },
        t4: { '14': null, '44': null, sin: null }
      };

      if (isRL1) {
        data.rl1.A = parseFloat(document.getElementById('rl1_A').value) || 0;
        data.rl1.F = parseFloat(document.getElementById('rl1_F').value) || null;
        data.rl1.sin = document.getElementById('rl1_sin').value;
        if (document.getElementById('modeToggle').checked) {
          data.rl1['B.A'] = parseFloat(document.getElementById('rl1_BA').value) || null;
          data.rl1.H = parseFloat(document.getElementById('rl1_H').value) || null;
          data.rl1.D = parseFloat(document.getElementById('rl1_D').value) || null;
          data.rl1['D-1'] = parseFloat(document.getElementById('rl1_D1').value) || null;
          data.rl1.N = parseFloat(document.getElementById('rl1_N').value) || null;
          data.rl1.J = parseFloat(document.getElementById('rl1_J').value) || null;
          data.rl1.K = parseFloat(document.getElementById('rl1_K').value) || null;
          data.rl1.L = parseFloat(document.getElementById('rl1_L').value) || null;
          data.rl1.M = parseFloat(document.getElementById('rl1_M').value) || null;
        }
      } else {
        data.t4['14'] = parseFloat(document.getElementById('t4_14').value) || 0;
        data.t4['44'] = parseFloat(document.getElementById('t4_44').value) || null;
        data.t4.sin = document.getElementById('t4_sin').value;
        if (document.getElementById('modeToggle').checked) {
          data.t4['17'] = parseFloat(document.getElementById('t4_17').value) || null;
          data.t4['16'] = parseFloat(document.getElementById('t4_16').value) || null;
          data.t4['55'] = parseFloat(document.getElementById('t4_55').value) || null;
          data.t4['18'] = parseFloat(document.getElementById('t4_18').value) || null;
          data.t4['20'] = parseFloat(document.getElementById('t4_20').value) || null;
          data.t4['52'] = parseFloat(document.getElementById('t4_52').value) || null;
          data.t4['46'] = parseFloat(document.getElementById('t4_46').value) || null;
          data.t4.benefits = parseFloat(document.getElementById('t4_benefits').value) || null;
        }
      }

      return data;
    }

    function calculate() {
      const data = getFormData();
      const income = data.source === 'RL-1' ? data.rl1.A : data.t4['14'];
      const unionDues = data.source === 'RL-1' ? data.rl1.F : data.t4['44'];
      const rrspContribution = parseFloat(document.getElementById('rrspInput').value) || 0;
      const rrsp = TaxCalculator.calculateRrspImpact(income, rrspContribution);
      const effectiveIncome = rrsp.newIncome;

      const solidarity = TaxCalculator.calculateSolidarityCredit(effectiveIncome);
      const workPremium = TaxCalculator.calculateWorkPremium(effectiveIncome);
      const cwb = TaxCalculator.calculateCWB(effectiveIncome);
      const bpaSavings = TaxCalculator.calculateBPA(effectiveIncome);

      const marginalRate = rrsp.marginalRate;
      const taxSaved = rrsp.taxSaved;

      const qcTotal = solidarity + workPremium;
      const fedTotal = bpaSavings + cwb;
      const totalBenefit = qcTotal + fedTotal + taxSaved;
      const cashBack = workPremium + cwb;

      let html = `<div class="result">
        <h3>${_('resultTitle')}</h3>
        <p><strong>${_('grossIncome')}: $${income.toLocaleString()}</strong></p>
        ${rrsp.contribution > 0 ? `<p>${_('afterRRSP')} ($${rrsp.contribution.toLocaleString()}): $${effectiveIncome.toLocaleString()}</p>` : ''}
        ${rrsp.contribution > 0 ? `<p>${_('taxSavings')} (${Math.round(marginalRate * 100)}%): $${taxSaved.toFixed(2)}</p>` : ''}
        <h4>${_('qcSection')}</h4>
        <p>${_('solidarityCredit')}: $${solidarity.toFixed(2)}</p>
        <p>${_('workPremium')}: $${workPremium.toFixed(2)}</p>
        <h4>${_('fedSection')}</h4>
        <p>${_('bpaSavings')}: $${bpaSavings.toFixed(2)}</p>
        <p>${_('cwb')}: $${cwb.toFixed(2)}</p>
        <hr>
        <p><strong>${_('totalBenefit')}: $${totalBenefit.toFixed(2)}</strong></p>
        <p style="font-size: 1.2em; color: #1890ff;"><strong>${_('cashRefund')}: $${cashBack.toFixed(2)}</strong></p>
      </div>`;

      // Smart warnings - only show if they save real money
      const warnings = [];
      if (unionDues === null && income > 30000) {
        warnings.push(_('warningUnionDues'));
      }

      if (warnings.length > 0) {
        html += `<div class="warnings"><strong>${_('warnings')}</strong><ul>`;
        warnings.forEach(w => html += `<li>${w}</li>`);
        html += '</ul></div>';
      }

      document.getElementById('output').innerHTML = html;

      // Store calculation data for export
      lastCalculationData = {
        ...data,
        analysis: {
          effectiveIncome,
          qcCredits: { solidarity, workPremium },
          fedCredits: { bpaSavings, cwb },
          rrspImpact: { contribution: rrsp.contribution, taxSaved, marginalRate }
        }
      };

      // Show export button if in advanced mode
      document.getElementById('exportBtn').style.display = document.getElementById('modeToggle').checked ? 'inline-block' : 'none';
      
      // Pre-fill JSON but keep hidden
      document.getElementById('jsonOutput').textContent = JSON.stringify(lastCalculationData, null, 2);
      document.getElementById('jsonOutput').style.display = 'none';
    }

    setLang('fr');
  </script>
</body>
</html>
