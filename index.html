<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TaxSyncQC ‚Äî Estimateur d'imp√¥t Qu√©bec</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; max-width: 600px; margin: 1rem auto; padding: 0 1rem; line-height: 1.6; }
    .lang-toggle { text-align: right; margin-bottom: 1rem; }
    .tab { display: flex; margin-bottom: 1rem; }
    .tab button {
      padding: 0.5rem 1rem; background: #eee; border: 1px solid #ccc; flex: 1;
    }
    .tab .active { background: #1890ff; color: white; }
    .input-group { margin-bottom: 1rem; }
    label { display: block; margin-bottom: 0.25rem; font-weight: bold; }
    input { width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; }
    .hint { font-size: 0.85rem; color: #666; margin-top: 0.25rem; }
    .rrsp-slider { margin: 1.5rem 0; }
    button.primary { background: #1890ff; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 4px; cursor: pointer; }
    .result { background: #e6f7ff; border-left: 4px solid #1890ff; padding: 1rem; margin: 1rem 0; border-radius: 4px; }
    .warnings { color: #fa8c16; margin-top: 1rem; }
  </style>
</head>
<body>
  <div class="lang-toggle">
    <button onclick="setLang('en')" id="btn-en">EN</button>
    <button onclick="setLang('fr')" id="btn-fr">FR</button>
  </div>

  <h1 id="title">üí∞ TaxSyncQC</h1>
  <p id="subtitle"><strong>Estimateur officiel Qu√©bec 2025</strong></p>

  <div class="tab">
    <button class="active" onclick="showTab('rl1')">RL-1 (Revenu Qu√©bec)</button>
    <button onclick="showTab('t4')">T4 (CRA)</button>
  </div>

  <form id="rl1-form" style="display:block;">
    <div class="input-group">
      <label id="l-boxA">RL-1 Box A (Line 101)</label>
      <input type="number" id="boxA" placeholder="Ex: 60000" step="100">
      <div class="hint" id="h-boxA">Revenu d'emploi avant retenues ‚Äî top left on RL-1</div>
    </div>
    <div class="input-group">
      <label id="l-boxF">RL-1 Box F (Line 397.1)</label>
      <input type="number" id="boxF" placeholder="Ex: 400" step="1">
      <div class="hint" id="h-boxF">Cotisations syndicales</div>
    </div>
    <div class="input-group">
      <label id="l-sin">SIN / NAS</label>
      <input type="text" id="sin" placeholder="Ex: 123 456 789" maxlength="11">
      <div class="hint" id="h-sin">9 chiffres, souvent pr√®s du nom de l'employeur</div>
    </div>
  </form>

  <form id="t4-form" style="display:none;">
    <div class="input-group">
      <label id="l-box14">T4 Box 14 (Line 10100)</label>
      <input type="number" id="box14" placeholder="Ex: 60000" step="100">
      <div class="hint" id="h-box14">Revenus d'emploi ‚Äî center-left on T4</div>
    </div>
    <div class="input-group">
      <label id="l-box44">T4 Box 44 (Line 21200)</label>
      <input type="number" id="box44" placeholder="Ex: 400" step="1">
      <div class="hint" id="h-box44">Cotisations syndicales</div>
    </div>
    <div class="input-group">
      <label id="l-sin2">SIN / NAS</label>
      <input type="text" id="sin2" placeholder="Ex: 123-456-789" maxlength="11">
      <div class="hint" id="h-sin2">Top-left corner</div>
    </div>
  </form>

  <div class="rrsp-slider">
    <label id="l-rrsp">Contribution RRSP / RRSP Contribution ($)</label>
    <input type="range" id="rrspSlider" min="0" max="31560" value="0" step="100">
    <div id="rrspValue">$0</div>
  </div>

  <button type="button" class="primary" onclick="calculate()">Estimer / Estimate</button>

  <div id="output"></div>

  <script>
    let lang = 'fr';
    const translations = {
      en: {
        title: "üí∞ TaxSyncQC ‚Äî Quebec Tax Estimator",
        subtitle: "Official 2025 estimator (RL-1 & T4)",
        l_boxA: "RL-1 Box A (Line 101)",
        h_boxA: "Employment income ‚Äî top left on RL-1",
        l_boxF: "RL-1 Box F (Line 397.1)",
        h_boxF: "Union dues",
        l_box14: "T4 Box 14 (Line 10100)",
        h_box14: "Employment income ‚Äî center-left on T4",
        l_box44: "T4 Box 44 (Line 21200)",
        h_box44: "Union dues",
        l_sin: "SIN / SIN",
        h_sin: "9 digits, near employer name",
        l_rrsp: "RRSP Contribution ($)",
        estimateBtn: "Estimate",
        resultTitle: "üßæ Quebec + Federal Estimate (2025)",
        income: "Income",
        solidarity: "Solidarity Credit",
        workPremium: "Work Premium",
        bpaSavings: "BPA Savings",
        cwb: "CWB (cash)",
        totalBenefit: "Total Benefit",
        cashBack: "Cash Back",
        warnings: "‚ö†Ô∏è Warnings:",
        missingUnionDues: "Union dues missing ‚Äî may be deductible",
        missingSIN: "SIN missing ‚Äî required for filing"
      },
      fr: {
        title: "üí∞ TaxSyncQC ‚Äî Estimateur d'imp√¥t Qu√©bec",
        subtitle: "Estimateur officiel 2025 (RL-1 et T4)",
        l_boxA: "RL-1 Case A (Ligne 101)",
        h_boxA: "Revenu d'emploi avant retenues ‚Äî en haut √† gauche",
        l_boxF: "RL-1 Case F (Ligne 397.1)",
        h_boxF: "Cotisations syndicales",
        l_box14: "T4 Case 14 (Ligne 10100)",
        h_box14: "Revenus d'emploi ‚Äî centre-gauche sur T4",
        l_box44: "T4 Case 44 (Ligne 21200)",
        h_box44: "Cotisations syndicales",
        l_sin: "SIN / NAS",
        h_sin: "9 chiffres, souvent pr√®s du nom de l'employeur",
        l_rrsp: "Contribution RRSP ($)",
        estimateBtn: "Estimer",
        resultTitle: "üßæ Estimation Qu√©bec + F√©d√©ral (2025)",
        income: "Revenu",
        solidarity: "Cr√©dit solidarit√©",
        workPremium: "Prime au travail",
        bpaSavings: "√âconomies BPA",
        cwb: "PTE (argent)",
        totalBenefit: "Avantage total",
        cashBack: "Remboursement",
        warnings: "‚ö†Ô∏è Avertissements :",
        missingUnionDues: "Cotisations syndicales manquantes ‚Äî peuvent √™tre d√©ductibles",
        missingSIN: "NAS manquant ‚Äî obligatoire pour la d√©claration"
      }
    };

    const _ = (key) => translations[lang][key] || key;

    function setLang(newLang) {
      lang = newLang;
      document.getElementById('btn-en').style.fontWeight = lang === 'en' ? 'bold' : 'normal';
      document.getElementById('btn-fr').style.fontWeight = lang === 'fr' ? 'bold' : 'normal';
      updateUI();
    }

    function updateUI() {
      document.getElementById('title').textContent = _( 'title' );
      document.getElementById('subtitle').textContent = _( 'subtitle' );
      document.getElementById('l-boxA').textContent = _( 'l_boxA' );
      document.getElementById('h-boxA').textContent = _( 'h_boxA' );
      document.getElementById('l-boxF').textContent = _( 'l_boxF' );
      document.getElementById('h-boxF').textContent = _( 'h_boxF' );
      document.getElementById('l-box14').textContent = _( 'l_box14' );
      document.getElementById('h-box14').textContent = _( 'h_box14' );
      document.getElementById('l-box44').textContent = _( 'l_box44' );
      document.getElementById('h-box44').textContent = _( 'h_box44' );
      document.getElementById('l-sin').textContent = _( 'l_sin' );
      document.getElementById('h-sin').textContent = _( 'h_sin' );
      document.getElementById('l-sin2').textContent = _( 'l_sin' );
      document.getElementById('h-sin2').textContent = _( 'h_sin' );
      document.getElementById('l-rrsp').textContent = _( 'l_rrsp' );
      document.querySelector('.primary').textContent = _( 'estimateBtn' );
    }

    function showTab(tabId) {
      document.getElementById('rl1-form').style.display = tabId === 'rl1' ? 'block' : 'none';
      document.getElementById('t4-form').style.display = tabId === 't4' ? 'block' : 'none';
      document.querySelectorAll('.tab button').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
    }

    document.getElementById('rrspSlider').addEventListener('input', function() {
      document.getElementById('rrspValue').textContent = `$${this.value}`;
    });

    function calculate() {
      let income, unionDues, sin;
      const isRL1 = document.getElementById('rl1-form').style.display === 'block';

      if (isRL1) {
        income = parseFloat(document.getElementById('boxA').value) || 0;
        unionDues = parseFloat(document.getElementById('boxF').value) || null;
        sin = document.getElementById('sin').value;
      } else {
        income = parseFloat(document.getElementById('box14').value) || 0;
        unionDues = parseFloat(document.getElementById('box44').value) || null;
        sin = document.getElementById('sin2').value;
      }

      const rrsp = parseFloat(document.getElementById('rrspSlider').value) || 0;
      const effectiveIncome = Math.max(0, income - rrsp);

      // QC credits
      const solidarity = effectiveIncome <= 57965 ? 531 : Math.max(0, 531 * (1 - (effectiveIncome - 57965) / 6160));
      const workPremium = effectiveIncome < 7200 ? 0 : Math.min(728, Math.min(effectiveIncome - 7200, 33100) * 0.26);

      // Fed credits
      const cwb = effectiveIncome <= 25539 ? Math.min(effectiveIncome * 0.27, 1519) : 
                 effectiveIncome <= 35539 ? Math.max(0, 1519 - (effectiveIncome - 25539) * 0.15) : 0;
      const bpa = Math.max(0, 15705 - Math.max(0, effectiveIncome - 165430) * 15705 / 70000);
      const bpaSavings = bpa * 0.15;

      // RRSP tax saved
      const marginalRate = income <= 51268 ? 0.2885 : income <= 57965 ? 0.3325 : 0.3885;
      const taxSaved = rrsp * marginalRate;

      const qcTotal = solidarity + workPremium;
      const fedTotal = bpaSavings + cwb;
      const totalBenefit = qcTotal + fedTotal + taxSaved;
      const cashBack = workPremium + cwb;

      let html = `<div class="result">
        <h3>${_( 'resultTitle' )}</h3>
        <p><strong>üíº ${_( 'income' )}: $${income.toLocaleString()}</strong></p>
        ${rrsp > 0 ? `<p>üìâ Apr√®s RRSP ($${rrsp}): $${effectiveIncome.toLocaleString()}</p>` : ''}
        ${rrsp > 0 ? `<p>üí∞ √âconomie d'imp√¥t: $${taxSaved.toFixed(2)}</p>` : ''}
        <h4>üá∂üá® Qu√©bec</h4>
        <p>üí∞ ${_( 'solidarity' )}: $${solidarity.toFixed(2)}</p>
        <p>üë∑ ${_( 'workPremium' )}: $${workPremium.toFixed(2)}</p>
        <h4>üá®üá¶ F√©d√©ral</h4>
        <p>üõ°Ô∏è ${_( 'bpaSavings' )}: $${bpaSavings.toFixed(2)}</p>
        <p>üíµ ${_( 'cwb' )}: $${cwb.toFixed(2)}</p>
        <hr style="margin: 1rem 0; border: none; border-top: 1px solid #ddd;">
        <p><strong>üéØ ${_( 'totalBenefit' )}: $${totalBenefit.toFixed(2)}</strong></p>
        <p style="font-size: 1.2em; color: #1890ff;"><strong>üí∏ ${_( 'cashBack' )}: $${cashBack.toFixed(2)}</strong></p>
      </div>`;

      const warnings = [];
      if (unionDues === null || isNaN(unionDues)) warnings.push(_( 'missingUnionDues' ));
      if (!sin || !/\d{9}/.test(sin.replace(/\D/g, ''))) warnings.push(_( 'missingSIN' ));
      if (warnings.length > 0) {
        html += `<div class="warnings"><strong>${_( 'warnings' )}</strong><ul>`;
        warnings.forEach(w => html += `<li>${w}</li>`);
        html += '</ul></div>';
      }

      document.getElementById('output').innerHTML = html;
    }

    // Init
    setLang('fr');
  </script>
</body>
</html>
